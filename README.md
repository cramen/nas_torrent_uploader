# Torrent Uploader

Torrent Uploader — это инструмент для удобной загрузки торрент-файлов напрямую с трекеров на ваш NAS (Network Attached Storage).

## Описание

Программа состоит из двух компонентов:
1. **Серверная часть** — Docker-контейнер, который запускается на вашем NAS и принимает загруженные торрент-файлы
2. **Плагин для браузера** — добавляет кнопки "Загрузить на NAS" рядом со ссылками скачивания торрентов на трекерах

**Важно:** Этот инструмент только загружает торрент-файлы на NAS. Чтобы начать скачивание самих торрентов, необходимо настроить ваш торрент-клиент (например, qBittorrent) на автоподхват торрент-файлов из соответствующих директорий.

## Преимущества использования

- Быстрая загрузка торрентов напрямую на NAS без промежуточного скачивания на компьютер
- Удобный выбор директории назначения через графический интерфейс
- Поддержка популярных торрент-трекеров
- Простая настройка и использование

## Установка серверной части (Docker-контейнер)

### Предварительные требования
- NAS с поддержкой Docker
- Docker и Docker Compose, установленные на вашем NAS

### Шаги по установке

1. Разместите файлы серверной части на вашем NAS в выбранной директории.

2. Создайте файл `docker-compose.yml`:

```yaml
version: '3'
services:
  torrent-uploader:
    build: .
    container_name: torrent-uploader
    restart: unless-stopped
    ports:
      - "3300:3000"
    volumes:
      - /host/dir1:/targets/dir1
      - /host/dir2:/targets/dir2
      - /host/dir3:/targets/dir3
    environment:
      - PORT=3000
      - TOKEN=your_secret_token_here
```

3. Замените `/host/dir1`, `/host/dir2`, `/host/dir3` на реальные пути к директориям на вашем NAS, где хранятся папки для торрентов. Вы можете указать столько директорий, сколько необходимо.

4. Установите уникальный секретный токен в переменной окружения `TOKEN`. Этот токен будет использоваться для аутентификации между плагином и сервером.

5. Соберите и запустите Docker-контейнер:

```bash
docker-compose up -d
```

### Настройка аутентификации

Для защиты API от несанкционированного доступа используется токен аутентификации. Токен передается как переменная окружения при запуске контейнера.

- **Установка токена**: В `docker-compose.yml` добавьте переменную окружения `TOKEN`:
  ```yaml
  environment:
    - PORT=3000
    - TOKEN=your_secret_token_here
  ```
  Замените `your_secret_token_here` на уникальный секретный токен.

- **Проверка токена**: Каждый запрос к API должен содержать параметр `token` в query-строке, например:
  ```
  GET /api/dirs?token=your_secret_token_here
  POST /api/upload?token=your_secret_token_here
  ```
  Если токен отсутствует или не совпадает, сервер вернет ошибку 401 (`Unauthorized`).

# Плагин Torrent Uploader

Плагин Torrent Uploader позволяет загружать торрент-файлы с трекеров напрямую на ваш NAS.

## Установка плагина для браузера

### Для Chrome/Edge:

1. Откройте страницу `chrome://extensions/` (или `edge://extensions/`)
2. Включите "Режим разработчика" (переключатель в правом верхнем углу)
3. Нажмите кнопку "Загрузить распакованное расширение"
4. Выберите директорию с файлами плагина

### Для Firefox:

1. Откройте `about:debugging#/runtime/this-firefox`
2. Нажмите "Загрузить временное дополнение"
3. Выберите файл `manifest.json` из директории плагина

## Настройка плагина

После установки плагина необходимо настроить адрес вашего NAS и токен аутентификации:

1. Нажмите на иконку плагина в панели инструментов браузера
2. Нажмите на ссылку "Настройки"
3. Введите корректные URL-адреса для вашего сервера:
   - URL для получения списка директорий: `http://ваш-nas.local:3300/api/dirs`
   - URL для загрузки торрент-файлов: `http://ваш-nas.local:3300/api/upload`
4. Введите токен аутентификации в поле "Токен для аутентификации". Этот токен должен совпадать с тем, что установлен в переменной окружения `TOKEN` Docker-контейнера.
5. Нажмите кнопку "Сохранить"

### Токен аутентификации

Для безопасного взаимодействия с API сервера необходимо указать токен аутентификации.

- **Установка токена**: В настройках плагина введите токен, который был указан в переменной окружения `TOKEN` при запуске Docker-контейнера.
- **Как это работает**: Плагин добавляет токен в каждый запрос к API как параметр query-строки (например, `?token=your_secret_token_here`). Если токен неверен или отсутствует, сервер вернет ошибку 401 (`Unauthorized`), и операция не будет выполнена.

## Использование

1. Перейдите на торрент-трекер (например, rutracker.org)
2. Найдите нужный торрент
3. Рядом со ссылкой для скачивания торрент-файла появится кнопка "Загрузить на NAS"
4. Нажмите на эту кнопку
5. В открывшемся окне выберите директорию назначения на NAS (например, `dir1/sub1`) из списка доступных поддиректорий
6. Нажмите "Загрузить"
7. После успешной загрузки вы увидите уведомление

## Примечания

- Ваш NAS должен быть доступен по сети с компьютера, на котором установлен плагин
- По умолчанию сервер использует порт 3300, если вы его измените, не забудьте обновить настройки в плагине
- Для корректной работы на NAS должны быть созданы директории, указанные в `docker-compose.yml`
- Для настройки автоматического добавления загруженных торрентов в ваш торрент-клиент на NAS, настройте наблюдение за примонтированными директориями в вашем торрент-клиенте (например, qBittorrent)
- Клиент теперь поддерживает относительные пути (например, `dir1/sub1`), что позволяет выбирать поддиректории из нескольких примонтированных директорий